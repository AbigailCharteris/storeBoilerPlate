import requestBatchesAction from './../actions/requestBatchesAction';
import { SAVE_BATCH } from './../constants/actionTypes';
import { BATCH } from './../constants/stateConstants';
import batchManagementApiFactory from './../shared/batchManagementApiFactory';

const saveBatchesEpic = (action$, { getState }) =>
  action$.ofType(SAVE_BATCH).mergeMap($action => {
    const api = batchManagementApiFactory(getState());

    const batch = $action.payload[BATCH];

    const apiStream = api.updateBatch(batch).map(requestBatchesAction);

    return apiStream;
  });

export default saveBatchesEpic;
