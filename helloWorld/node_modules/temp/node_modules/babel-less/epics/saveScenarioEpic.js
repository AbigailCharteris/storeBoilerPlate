import requestScenariosAction from '../actions/requestScenariosAction';
import { SAVE_SCENARIO } from '../constants/actionTypes';
import { SCENARIO } from '../constants/stateConstants';
import batchManagementApiFactory from '../shared/batchManagementApiFactory';

const saveScenariosEpic = (action$, { getState }) =>
  action$.ofType(SAVE_SCENARIO).mergeMap($action => {
    const api = batchManagementApiFactory(getState());

    const scenario = $action.payload[[SCENARIO]];

    const apiStream = api.updateScenario(scenario).map(requestScenariosAction);

    return apiStream;
  });

export default saveScenariosEpic;
