import requestScenariosAuditFulfilled from '../actions/requestScenariosAuditFulfilledAction';
import { REQUEST_SCENARIOS_AUDIT } from '../constants/actionTypes';
import batchManagementApiFactory from '../shared/batchManagementApiFactory';
import { adaptScenarioList } from '../shared/datasourceAdapters';

const getScenariosAuditEpic = (action$, { getState }) =>
  action$.ofType(REQUEST_SCENARIOS_AUDIT).mergeMap(() => {
    const api = batchManagementApiFactory(getState());

    const apiStream = api
      .requestScenarioAuditList()
      .map(adaptScenarioList)
      .map(requestScenariosAuditFulfilled);

    return apiStream;
  });

export default getScenariosAuditEpic;
