import requestScenariosFulfilled from '../actions/requestScenariosFulfilledAction';
import { REQUEST_SCENARIOS } from '../constants/actionTypes';
import batchManagementApiFactory from '../shared/batchManagementApiFactory';
import { adaptScenarioList } from '../shared/datasourceAdapters';

const getScenariosEpic = (action$, { getState }) =>
  action$.ofType(REQUEST_SCENARIOS).mergeMap(() => {
    const api = batchManagementApiFactory(getState());

    const apiStream = api
      .requestScenarioList()
      .map(adaptScenarioList)
      .map(requestScenariosFulfilled);

    return apiStream;
  });

export default getScenariosEpic;
