import { assert, expect } from 'chai';
import sinon from 'sinon';
import {
  REQUEST_SCENARIO_VERSIONS_FULFILLED,
  REQUEST_SCENARIOS_FULFILLED,
} from '../../constants/actionTypes';
import { SCENARIO_VERSION_LIST_NO_DATA } from '../../constants/stateConstants';

import scenarioReducer, {
  __RewireAPI__ as mock,
} from '../../reducers/scenarioReducer';

describe('scenarioReducer', () => {
  const fromModelMock = sinon.stub();

  beforeEach(() => {
    mock.__Rewire__('requestScenariosFulfilledAdapter', {
      fromModel: fromModelMock,
    });
    mock.__Rewire__('requestScenarioVersionsFulfilledAdapter', {
      fromModel: fromModelMock,
    });
  });

  afterEach(() => {
    mock.__ResetDependency__('requestScenariosFulfilledAdapter');
    mock.__ResetDependency__('requestScenarioVersionsFulfilledAdapter');
  });

  it('should do nothing if action type is not supported', () => {
    const providedState = { existingState: 'test' };
    const providedAction = {
      type: 'CATS',
    };

    const actualReducer = scenarioReducer(providedState, providedAction);

    expect(actualReducer).to.deep.equal(providedState);
  });

  it('should merge state when scenario fulfilled', () => {
    const fakeActionModel = { miles: 'test' };

    const providedState = { existingState: 'test' };
    const providedAction = {
      type: REQUEST_SCENARIOS_FULFILLED,
    };

    fromModelMock.withArgs(providedAction).returns(fakeActionModel);

    const actualReducer = scenarioReducer(providedState, providedAction);

    expect(actualReducer).to.deep.equal({
      existingState: 'test',
      miles: 'test',
    });
  });

  it('should merge state when scenario versions fulfilled', () => {
    const fakeActionModel = { miles: 'test' };

    const providedState = { existingState: 'test' };
    const providedAction = {
      type: REQUEST_SCENARIO_VERSIONS_FULFILLED,
    };

    fromModelMock.withArgs(providedAction).returns(fakeActionModel);

    const actualReducer = scenarioReducer(providedState, providedAction);

    expect(actualReducer).to.deep.equal({
      existingState: 'test',
      miles: 'test',
    });
  });
});
