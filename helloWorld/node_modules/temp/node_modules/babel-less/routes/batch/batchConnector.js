import { connect } from 'react-redux';
import requestBatches from '../../actions/requestBatchesAction';
import saveBatch from '../../actions/saveBatchAction';
import { BATCHES, SCENARIOS } from '../../constants/reducerTypes';
import {
  BATCH_LIST,
  CAN_EDIT,
  SCENARIO_LIST,
} from '../../constants/stateConstants';
import { REQUEST_BATCHES, SAVE_BATCH } from '../../constants/actionTypes';
import getPrinciple from '../../../auth/selectors/getPrinciple';
import Entitlement from '../../../auth/model/entitlement';

/* Externalise connecting to redux */

const mapStateToProps = state => {
  const mapppedState = {
    [SCENARIO_LIST]: state[SCENARIOS][SCENARIO_LIST],
    [BATCH_LIST]: state[BATCHES][BATCH_LIST],
    [CAN_EDIT]:
      getPrinciple(state).hasRole('ADMIN') ||
      getPrinciple(state).hasOneOrMoreEntitlements(
        Entitlement.from('ui.batch-management', 'read-write')
      ),
  };

  return mapppedState;
};

const mapActionsToProps = {
  [REQUEST_BATCHES]: requestBatches,
  [SAVE_BATCH]: saveBatch,
};

const connector = Component =>
  connect(mapStateToProps, mapActionsToProps)(Component);

export default connector;
