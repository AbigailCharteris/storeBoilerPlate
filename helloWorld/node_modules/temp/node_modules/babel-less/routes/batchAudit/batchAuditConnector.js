import { connect } from 'react-redux';
import requestBatches from '../../actions/requestBatchesAction';
import { BATCHES, SCENARIOS } from '../../constants/reducerTypes';
import { BATCH_LIST, CAN_EDIT, FILTER } from '../../constants/stateConstants';
import { REQUEST_BATCHES } from '../../constants/actionTypes';
import getPrinciple from '../../../auth/selectors/getPrinciple';
import Entitlement from '../../../auth/model/entitlement';

/* Externalise connecting to redux */

const mapStateToProps = state => {
  const mapppedState = {
    [BATCH_LIST]: state[BATCHES][BATCH_LIST],
    [FILTER]: state[SCENARIOS][FILTER],
    [CAN_EDIT]:
      getPrinciple(state).hasRole('ADMIN') ||
      getPrinciple(state).hasOneOrMoreEntitlements(
        Entitlement.from('ui.batch-management', 'read-write')
      ),
  };

  return mapppedState;
};

const mapActionsToProps = {
  [REQUEST_BATCHES]: requestBatches,
};

const connector = Component =>
  connect(mapStateToProps, mapActionsToProps)(Component);

export default connector;
